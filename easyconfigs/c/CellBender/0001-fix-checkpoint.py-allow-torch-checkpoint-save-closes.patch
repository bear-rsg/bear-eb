From 4334e8966217c3591bf7c545f31ab979cdc6590d Mon Sep 17 00:00:00 2001
From: lukabor <94577648+lukabor@users.noreply.github.com>
Date: Fri, 28 Jun 2024 11:52:25 +0200
Subject: [PATCH] fix(checkpoint.py): allow torch checkpoint save closes
 broadinstitute/CellBender#296

application of the solution in https://github.com/broadinstitute/CellBender/issues/296
---
 cellbender/remove_background/checkpoint.py | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/cellbender/remove_background/checkpoint.py b/cellbender/remove_background/checkpoint.py
index 44ed12e..9baff4a 100644
--- a/cellbender/remove_background/checkpoint.py
+++ b/cellbender/remove_background/checkpoint.py
@@ -112,8 +112,8 @@ def save_checkpoint(filebase: str,
 
             file_list = save_random_state(filebase=filebase)
 
-            torch.save(model_obj, filebase + '_model.torch')
-            torch.save(scheduler, filebase + '_optim.torch')
+            torch.save(model_obj.state_dict(), filebase + '_model.torch')
+            scheduler.save(filebase + '_optim.torch')
             scheduler.save(filebase + '_optim.pyro')  # use PyroOptim method
             pyro.get_param_store().save(filebase + '_params.pyro')
             file_list = file_list + [filebase + '_model.torch',
-- 
2.43.7

